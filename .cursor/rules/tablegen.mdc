---
description: TableGen Rules for MLIR Dialects and Passes
globs: *.td
alwaysApply: false
---

# TableGen Rules

This section defines standards for defining MLIR Dialects and Passes, particularly focusing on the use of `dependentDialects` in TableGen (`.td`) files.

## Dialect: `dependentDialects` Management

When defining a Dialect, the `dependentDialects` field is used to record dependencies on other dialects whose components (Operations, Attributes, or Types) are **reused, relied upon, or constructed** by the current Dialect itself.

Example:

```
def MyDialect : Dialect {
  // Here we register the Arithmetic and Func dialect as dependencies of our `MyDialect`.
  let dependentDialects = [
    "arith::ArithDialect",
    "func::FuncDialect"
  ];
}
```

For every Dialect listed in the `dependentDialects` of a Dialect, the corresponding C++ header file **must** be included in the Dialect definition file.

```c++
// IWYU pragma: begin_keep
// Headers needed for FieldDialect.cpp.inc
#include "mlir/IR/OperationSupport.h"
#include "prime_ir/Dialect/ModArith/IR/ModArithDialect.h"
// IWYU pragma: end_keep
```

## Pass: `dependentDialects` Management

The `dependentDialects` list in a `Pass` definition must only include Dialects for which the Pass **introduces new entities** (Operations, Attributes, Types, etc.) during its execution.

- **Rule:** The list should contain only Dialects whose entities are **newly created or explicitly used to construct a transformation** by the Pass.
- **Avoid:** Do not include Dialects that are merely consumed, transformed, or required for general Pass setup.
  - _Example:_ If a Pass transforms `tensor` ops into `memref` ops, and does not create new `tensor` ops, `tensor::TensorDialect` should not be listed as a dependent dialect.

For every Dialect listed in the `dependentDialects` of a Pass, the corresponding C++ header file **must** be included in the Pass definition file (e.g., `*Pass.h`).

Example (for `TensorExtToTensorPass`):

```c++
// IWYU pragma: begin_keep
// Headers needed for TensorExtToTensor.h.inc
#include "mlir/Dialect/Bufferization/IR/Bufferization.h"
#include "mlir/Dialect/LLVMIR/LLVMDialect.h"
#include "mlir/Dialect/MemRef/IR/MemRef.h"
#include "mlir/Dialect/SCF/IR/SCF.h"
#include "mlir/Pass/Pass.h"
// IWYU pragma: end_keep
```
